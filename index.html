<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tool NRO Search Item And Option - Auto</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --main: #00ff88; --bg: #0d0d0d; --card: #1a1a1a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; }
        .wrapper { max-width: 1400px; margin: auto; display: grid; grid-template-columns: 450px 1fr; gap: 20px; }
        .panel { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #333; }
        input, select { width: 100%; padding: 10px; background: #222; color: #fff; border: 1px solid #444; border-radius: 6px; margin-bottom: 8px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 5px; }
        .btn-add { background: var(--main); color: #000; }
        #log { background: #000; color: #00ff41; padding: 15px; height: 550px; overflow-y: auto; font-family: 'Consolas', monospace; border-radius: 6px; white-space: pre-wrap; border: 1px solid #222; }
        .opt-row { display: grid; grid-template-columns: 2.5fr 1fr; gap: 5px; margin-bottom: 5px; }
        label { font-size: 11px; color: #888; text-transform: uppercase; display: block; margin-top: 10px; }
        .loading-status { color: var(--main); font-size: 13px; margin-bottom: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="panel">
        <h2 style="color: var(--main); text-align: center; margin: 0 0 15px 0; font-size: 20px;">TOOL SEARCH ITEM OPTION</h2>
        
        <div id="status" class="loading-status">‚è≥ ƒêang t·ª± ƒë·ªông n·∫°p d·ªØ li·ªáu t·ª´ GitHub...</div>

        <div id="mainUI" style="display:none">
            <label>üîç T√¨m ki·∫øm trang b·ªã:</label>
            <input type="text" id="searchItem" placeholder="G√µ t√™n ƒë·ªì..." oninput="filterItems()">
            <select id="itemList" size="6" style="height: 120px;"></select>

            <label>üëï Ch·ªçn Set Clothes (D·ªØ li·ªáu t·ª´ Option):</label>
            <select id="clothesId"></select>

            <label>‚öôÔ∏è Ch·ªâ s·ªë Option:</label>
            <div id="optionContainer"></div>
            <button class="btn" style="background: #333; color: #ccc; font-size: 10px;" onclick="addOptionRow()">+ Th√™m Option</button>
            
            <button class="btn btn-add" style="margin-top: 15px;" onclick="generate()">T·∫†O L·ªÜNH</button>
            <button class="btn" style="background: #2980b9; color: #fff;" onclick="copyLog()">COPY TO√ÄN B·ªò</button>
        </div>
    </div>

    <div class="panel">
        <h3 style="margin:0; color: var(--main); font-size: 14px;">DANH S√ÅCH L·ªÜNH</h3>
        <hr style="border:0; border-top:1px solid #333; margin: 10px 0;">
        <div id="log">ƒêang t·∫£i d·ªØ li·ªáu, vui l√≤ng ƒë·ª£i...</div>
    </div>
</div>

<script>
    let dbItem = [];
    let dbOpt = [];

    // B·ªô ID chu·∫©n t·ª´ b·∫£n kh√¥ng l·ªói c·ªßa √¥ng
    const GEN_DATA = {
        "G0 - TR√ÅI ƒê·∫§T": [139, 140, 141],
        "G1 - NAM·∫æC": [142, 143, 144],
        "G2 - XAYDA": [136, 137, 138]
    };

    // T·ª± ƒë·ªông ch·∫°y khi m·ªü trang web
    window.onload = function() {
        autoLoadFiles();
    };

    function autoLoadFiles() {
        // T·∫£i file item.csv
        Papa.parse("item.csv", {
            download: true, header: true, skipEmptyLines: true,
            complete: function(res) {
                dbItem = res.data.map(i => ({
                    id: getVal(i, ['id', 'ID']),
                    name: getVal(i, ['name', 'NAME']),
                    g: getVal(i, ['gender', 'Gender'])
                })).filter(i => i.id !== null);
                checkReady();
            }
        });

        // T·∫£i file option.csv
        Papa.parse("option.csv", {
            download: true, header: true, skipEmptyLines: true,
            complete: function(res) {
                dbOpt = res.data.map(i => ({
                    id: getVal(i, ['id', 'ID']),
                    name: getVal(i, ['name', 'NAME'])
                })).filter(o => o.id !== null);
                checkReady();
            }
        });
    }

    function checkReady() {
        if (dbItem.length > 0 && dbOpt.length > 0) {
            document.getElementById('status').innerText = "‚úÖ D·ªØ li·ªáu ƒë√£ s·∫µn s√†ng!";
            document.getElementById('mainUI').style.display = 'block';
            document.getElementById('log').innerText = "";
            renderClothesMenu();
            renderDefaultOptions();
            filterItems();
        }
    }

    function getVal(obj, keys) {
        for (let key of keys) {
            let foundKey = Object.keys(obj).find(k => k.toLowerCase().trim() === key.toLowerCase());
            if (foundKey && obj[foundKey] !== undefined) return obj[foundKey].toString().replace(/"/g, '').trim();
        }
        return null;
    }

    function renderClothesMenu() {
        const select = document.getElementById('clothesId');
        select.innerHTML = "";
        for (let gen in GEN_DATA) {
            let group = document.createElement('optgroup');
            group.label = gen;
            GEN_DATA[gen].forEach(id => {
                let optObj = dbOpt.find(o => o.id == id);
                let name = optObj ? optObj.name : "Kh√¥ng r√µ t√™n";
                name = name.replace(/\$\((.*)\)/, '$1');
                let opt = document.createElement('option');
                opt.value = id;
                opt.textContent = `${name} (ID: ${id})`;
                group.appendChild(opt);
            });
            select.appendChild(group);
        }
    }

    function renderDefaultOptions() {
        const container = document.getElementById('optionContainer');
        container.innerHTML = "";
        addOptionRow(50, 100); addOptionRow(77, 100); addOptionRow(103, 100);
    }

    function filterItems() {
        const key = document.getElementById('searchItem').value.toLowerCase();
        const list = document.getElementById('itemList');
        list.innerHTML = "";
        dbItem.filter(i => i.name.toLowerCase().includes(key) || i.id.includes(key))
              .slice(0, 100).forEach(i => {
                  let opt = document.createElement('option');
                  opt.value = i.id;
                  opt.textContent = `[ID:${i.id}] ${i.name} (G${i.g})`;
                  list.appendChild(opt);
              });
    }

    function addOptionRow(defaultId = 0, defaultVal = 0) {
        const container = document.getElementById('optionContainer');
        const div = document.createElement('div');
        div.className = 'opt-row';
        let selectHtml = `<select class="opt-id">`;
        dbOpt.forEach(o => {
            selectHtml += `<option value="${o.id}" ${o.id == defaultId ? 'selected' : ''}>${o.name} (ID:${o.id})</option>`;
        });
        selectHtml += `</select>`;
        div.innerHTML = `${selectHtml}<input type="number" class="opt-val" value="${defaultVal}">`;
        container.appendChild(div);
    }

    function generate() {
        const itemBox = document.getElementById('itemList');
        if (itemBox.selectedIndex === -1) return alert("Ch·ªçn ƒë·ªì ƒë√£!");
        const itemId = itemBox.value;
        const itemName = itemBox.options[itemBox.selectedIndex].text;
        const clothesId = document.getElementById('clothesId').value;
        const clothesName = document.getElementById('clothesId').options[document.getElementById('clothesId').selectedIndex].text;
        let optString = `${clothesId}-0`;
        document.querySelectorAll('.opt-row').forEach(row => {
            const id = row.querySelector('.opt-id').value;
            const val = row.querySelector('.opt-val').value;
            if(id) optString += ` ${id}-${val}`;
        });
        const log = document.getElementById('log');
        log.innerText += `// ${itemName} | K√≠ch set: ${clothesName}\nId ${itemId} (${optString})\n\n`;
        log.scrollTop = log.scrollHeight;
    }

    function copyLog() {
        navigator.clipboard.writeText(document.getElementById('log').innerText);
        alert("ƒê√£ copy!");
    }
</script>
</body>
</html>
